<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz TV - Wczytywanie Ręczne (FINALNA POPRAWKA)</title>
    <style>
        :root {
            --bg-dark: #1e1e24;
            --bg-panel: #2b2b36;
            --accent: #44445a;
            --highlight: #5c7cfa;
            --text-main: #e1e1e6;
            --text-muted: #a0a0b0;
            --success: #4cc9f0;
            --danger: #f72585;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            padding: 15px 30px;
            background-color: var(--bg-panel);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        h1 { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: white;
            font-size: 0.9rem;
        }

        .btn-end { background-color: var(--danger); }
        .btn-reset { background-color: var(--accent); margin-right: 10px; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* MAIN LAYOUT */
        .container {
            display: flex;
            flex: 1;
            height: calc(100vh - 60px);
        }

        /* SIDEBAR */
        .sidebar {
            width: 350px;
            background-color: var(--bg-panel);
            overflow-y: auto;
            border-right: 1px solid var(--accent);
            padding: 20px;
        }

        .participant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: var(--bg-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .participant:hover { background-color: var(--accent); }
        
        .participant.active {
            border-color: var(--highlight);
            background-color: rgba(92, 124, 250, 0.15);
            box-shadow: 0 0 15px rgba(92, 124, 250, 0.1);
        }

        .p-name { font-weight: 500; }
        .p-score { font-weight: bold; font-size: 1.2rem; color: var(--highlight); }

        /* QUESTION AREA */
        .main-content {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .question-box {
            text-align: center;
            max-width: 900px;
            width: 100%;
        }

        .q-counter {
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .q-text {
            font-size: 3rem;
            margin-bottom: 40px;
            line-height: 1.3;
            font-weight: 600;
            min-height: 150px;
            display: flex; align-items: center; justify-content: center;
        }

        /* Odpowiedź ma tylko podstawowe style, ukrywanie i pokazywanie będzie w JS */
        .a-text {
            font-size: 2rem;
            color: var(--success);
            margin-bottom: 40px;
            font-weight: bold;
            display: none; /* Domyślnie ukryty, manipulowany w JS */
            padding-top: 10px; /* Estetyczny odstęp, gdy się pojawi */
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            min-height: 80px;
        }

        .btn-large {
            padding: 15px 50px;
            font-size: 1.3rem;
            border-radius: 50px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .btn-show { background-color: var(--highlight); }
        .btn-good { background-color: var(--success); display: none; }
        .btn-bad { background-color: var(--danger); display: none; }

        .hint-text {
            margin-top: 20px;
            color: var(--text-muted);
            font-style: italic;
            opacity: 0.6;
        }

        /* START SCREEN / UPLOAD */
        .start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-dark);
            z-index: 50;
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .btn-upload {
            border: 2px dashed var(--text-muted);
            color: var(--text-main);
            background-color: transparent;
            padding: 40px 80px;
            border-radius: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-upload:hover {
            border-color: var(--highlight);
            color: var(--highlight);
            background-color: rgba(92, 124, 250, 0.05);
        }

        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0; top: 0; opacity: 0;
            width: 100%; height: 100%;
            cursor: pointer;
        }

        /* PODIUM */
        .podium-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(10,10,15,0.98);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .podium-overlay.show { opacity: 1; pointer-events: all; }

        .podium-stage {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            height: 400px;
        }

        .podium-bar {
            width: 150px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            border-radius: 10px 10px 0 0;
            transform: translateY(100%);
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .podium-overlay.show .podium-bar { transform: translateY(0); }
        .podium-overlay.show .bar-1 { transition-delay: 0.5s; }
        .podium-overlay.show .bar-2 { transition-delay: 0.3s; }
        .podium-overlay.show .bar-3 { transition-delay: 0.1s; }

        .bar-1 { height: 100%; background: linear-gradient(to top, #b8860b, var(--gold)); order: 2; z-index: 2; }
        .bar-2 { height: 75%; background: linear-gradient(to top, #7f8c8d, var(--silver)); order: 1; }
        .bar-3 { height: 60%; background: linear-gradient(to top, #a0522d, var(--bronze)); order: 3; }

        .winner-name { margin-bottom: 10px; font-weight: bold; font-size: 1.2rem; text-align: center; }
        .winner-score { font-size: 2rem; color: white; margin-bottom: 20px; }
        .place-number { font-size: 5rem; color: rgba(255,255,255,0.3); font-weight: 900; margin-bottom: -20px;}

    </style>
</head>
<body>

    <div class="start-screen" id="startScreen">
        <h1 style="margin-bottom: 30px; font-size: 2rem;">Witaj w Quizie</h1>
        <div class="upload-btn-wrapper">
            <button class="btn-upload">Kliknij, aby wczytać plik z pytaniami (sss.txt)</button>
            <input type="file" id="fileInput" accept=".txt">
        </div>
        <p style="margin-top: 20px; color: var(--text-muted);">Format: pytanie;odpowiedź</p>
    </div>

    <header>
        <h1>Quiz Tournament</h1>
        <div>
            <button class="btn btn-reset" onclick="resetApp()">Nowa Gra</button>
            <button class="btn btn-end" onclick="endGame()">Zakończ i Podium</button>
        </div>
    </header>

    <div class="container">
        <div class="sidebar" id="participantsList"></div>

        <div class="main-content">
            <div class="question-box" id="questionBox">
                <div class="q-counter" id="qCounter">...</div>
                <div class="q-text" id="qText">Wczytaj pytania, aby rozpocząć grę!</div>
                <div class="a-text" id="aText"></div>
                
                <div class="controls" id="controlsArea"></div>
                <div class="hint-text" id="hintText"></div>
            </div>
        </div>
    </div>

    <div class="podium-overlay" id="podium">
        <h1 style="margin-bottom: 40px; font-size: 3rem; color: var(--gold);">KONIEC GRY!</h1>
        <div class="podium-stage" id="podiumStage"></div>
        <button class="btn btn-reset" style="margin-top: 50px; background: var(--highlight);" onclick="resetApp()">Zamknij</button>
    </div>

    <script>
        const initialParticipants = [
            "Pan Robert Ciupka", "Pan Franciszek Dzida", "Pani Martyna Dziech",
            "Pan Michał Filimanowski", "Pan Jakub Filip", "Pani Magda Głąbek",
            "Pani Julia Holisz", "Pan Patryk Jesionek", "Pani Natasza Juszczuk",
            "Pani Laura Kirchner", "Pani Hanna Kocoń", "Pan Miłosz Kopeć",
            "Pani Joanna Krupnik", "Pan Mateusz Machalica", "Pan Patryk Machała",
            "Pan Marek Polaczek", "Pani Weronika Rojczyk", "Pan Wojciech Szary",
            "Pan Bartosz Wiśniewski"
        ];

        let state = {
            participants: [],
            questions: [],
            currentQuestionIndex: 0,
            selectedParticipantIndex: null
        };

        // --- INIT ---
        window.onload = () => {
            loadLocalState();
            
            if (state.questions && state.questions.length > 0) {
                renderGame();
            } else {
                document.getElementById('startScreen').style.display = 'flex';
                if (state.participants.length === 0) {
                    state.participants = initialParticipants.map(name => ({ name, score: 0 }));
                }
                renderParticipants();
            }
        };

        // Obsługa wczytania pliku (używamy FileReader, który działa lokalnie)
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n');
                
                const newQuestions = lines
                    .filter(line => line.includes(';'))
                    .map(line => {
                        const [q, a] = line.split(';');
                        return { text: q.trim(), answer: a.trim() };
                    });
                
                if (newQuestions.length === 0) {
                     alert("Plik jest pusty lub ma nieprawidłowy format (pytanie;odpowiedź).");
                     return;
                }
                
                state.questions = newQuestions;
                state.currentQuestionIndex = 0;
                
                saveLocalState();
                document.getElementById('startScreen').style.display = 'none';
                renderGame();
            };
            reader.readAsText(file);
        });

        // --- RENDEROWANIE ---
        function renderGame() {
            renderParticipants();
            renderCurrentQuestion();
        }

        function renderParticipants() {
            const list = document.getElementById('participantsList');
            list.innerHTML = '';
            
            state.participants.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = `participant ${state.selectedParticipantIndex === index ? 'active' : ''}`;
                div.onclick = () => selectParticipant(index);
                div.innerHTML = `
                    <span class="p-name">${index + 1}. ${p.name}</span>
                    <span class="p-score">${p.score} pkt</span>
                `;
                list.appendChild(div);
            });
        }

        function renderCurrentQuestion() {
            const aText = document.getElementById('aText');
            const qText = document.getElementById('qText');
            const qCounter = document.getElementById('qCounter');
            const controls = document.getElementById('controlsArea');
            const hint = document.getElementById('hintText');

            if (!state.questions || state.questions.length === 0) {
                 qText.innerText = "Wczytaj pytania, aby rozpocząć grę!";
                 qCounter.innerText = "STATUS";
                 controls.innerHTML = '';
                 hint.innerText = '';
                 aText.style.display = 'none'; // Ukrywamy brutalnie
                 return;
            }

            if (state.currentQuestionIndex >= state.questions.length) {
                qText.innerText = "Wszystkie pytania wyczerpane!";
                qCounter.innerText = "KONIEC GRY";
                controls.innerHTML = '';
                hint.innerText = 'Kliknij "Zakończ i Podium" aby zobaczyć wyniki.';
                aText.style.display = 'none';
                return;
            }

            const q = state.questions[state.currentQuestionIndex];
            
            // KLUCZOWA POPRAWKA JS: Ustawiamy styl na 'none' zanim zmienimy tekst
            aText.style.display = 'none';
            
            qCounter.innerText = `Pytanie ${state.currentQuestionIndex + 1} z ${state.questions.length}`;
            qText.innerText = q.text;
            aText.innerText = q.answer;

            if (state.selectedParticipantIndex === null) {
                controls.innerHTML = '';
                hint.innerText = "Wybierz osobę z listy, aby odblokować przycisk odpowiedzi.";
            } else {
                controls.innerHTML = `
                    <button class="btn btn-large btn-show" onclick="revealAnswer()">Pokaż odpowiedź</button>
                `;
                hint.innerText = `Osoba odpowiadająca: ${state.participants[state.selectedParticipantIndex].name}`;
            }
        }

        // --- LOGIKA ---
        function selectParticipant(index) {
            if (state.currentQuestionIndex >= state.questions.length) return;
            state.selectedParticipantIndex = index;
            saveLocalState();
            renderGame();
        }

        function revealAnswer() {
            // KLUCZOWA POPRAWKA JS: Pokaż, używając 'block'
            document.getElementById('aText').style.display = 'block'; 
            const controls = document.getElementById('controlsArea');
            controls.innerHTML = `
                <button class="btn btn-large btn-good" style="display:inline-block" onclick="submitScore(2)">Dobrze (+2)</button>
                <button class="btn btn-large btn-bad" style="display:inline-block" onclick="submitScore(-1)">Źle (-1)</button>
            `;
            document.getElementById('hintText').innerText = 'Oceń odpowiedź i przejdź do kolejnego pytania.';
        }

        function submitScore(points) {
            if (state.selectedParticipantIndex !== null) {
                state.participants[state.selectedParticipantIndex].score += points;
                state.currentQuestionIndex++;
                state.selectedParticipantIndex = null;
                saveLocalState();
                renderGame();
            }
        }

        function endGame() {
            const podiumOverlay = document.getElementById('podium');
            const stage = document.getElementById('podiumStage');
            
            const sorted = [...state.participants].sort((a, b) => b.score - a.score);
            const top3 = sorted.slice(0, 3);

            let html = '';
            if(top3[1]) html += createPodiumBar(top3[1], 2, 'bar-2');
            if(top3[0]) html += createPodiumBar(top3[0], 1, 'bar-1');
            if(top3[2]) html += createPodiumBar(top3[2], 3, 'bar-3');

            stage.innerHTML = html;
            podiumOverlay.classList.add('show');
        }

        function createPodiumBar(player, place, className) {
            return `
                <div class="podium-bar ${className}">
                    <div class="winner-name">${player.name}</div>
                    <div class="winner-score">${player.score} pkt</div>
                    <div class="place-number">${place}</div>
                </div>
            `;
        }

        // --- SAVE/LOAD ---
        function saveLocalState() {
            localStorage.setItem('quiz_manual_state', JSON.stringify(state));
        }

        function loadLocalState() {
            const saved = localStorage.getItem('quiz_manual_state');
            if (saved) {
                const loadedState = JSON.parse(saved);
                
                if (loadedState.participants.length === initialParticipants.length) {
                    state = loadedState;
                } else {
                    state.participants = initialParticipants.map(name => ({ name, score: 0 }));
                    state.questions = loadedState.questions || [];
                    state.currentQuestionIndex = 0;
                }
            } else {
                 state.participants = initialParticipants.map(name => ({ name, score: 0 }));
            }
        }

        function resetApp() {
            if(confirm("Czy na pewno chcesz zresetować grę? Stracisz wszystkie punkty i zaczniesz od pierwszego pytania.")) {
                localStorage.removeItem('quiz_manual_state');
                location.reload();
            }
        }
    </script>
</body>
</html>
